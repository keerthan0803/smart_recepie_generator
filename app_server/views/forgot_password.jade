extends layout

block content
  .container(style='max-width: 500px; margin: 50px auto; padding: 30px; background: white; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);')
    h2(style='text-align: center; color: #1f2937; margin-bottom: 30px;') Forgot Password
    p(style='text-align: center; color: #6b7280; margin-bottom: 30px;') Enter your email address and we'll send you a link to reset your password.
    
    form#forgotPasswordForm(method='POST' style='display: flex; flex-direction: column; gap: 20px;')
      .form-group
        label(for='email' style='display: block; margin-bottom: 8px; color: #374151; font-weight: 500;') Email Address
        input#email(type='email' name='email' required style='width: 100%; padding: 12px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 14px;' placeholder='you@example.com')
      
      #message(style='font-size: 14px; display: none; padding: 10px; border-radius: 6px; margin-bottom: 10px;')
      
      button(type='submit' style='width: 100%; padding: 12px; background: #2563eb; color: white; border: none; border-radius: 6px; font-size: 16px; font-weight: 500; cursor: pointer;') Send Reset Link
      
      .text-center(style='margin-top: 10px;')
        a(href='/sign_in' style='color: #2563eb; text-decoration: none; font-size: 14px;') Back to Sign In

  script.
    document.getElementById('forgotPasswordForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const email = document.getElementById('email').value;
      const messageDiv = document.getElementById('message');
      const submitButton = document.querySelector('button[type="submit"]');
      
      // Disable button during request
      submitButton.disabled = true;
      submitButton.textContent = 'Sending...';
      
      try {
        const response = await fetch('/api/customer/forgot-password', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ email })
        });
        
        const data = await response.json();
        
        messageDiv.style.display = 'block';
        
        if (data.success) {
          messageDiv.style.background = '#d1fae5';
          messageDiv.style.color = '#065f46';
          messageDiv.textContent = data.message;
          document.getElementById('email').value = '';
        } else {
          messageDiv.style.background = '#fee2e2';
          messageDiv.style.color = '#991b1b';
          messageDiv.textContent = data.message || 'Failed to send reset link';
        }
      } catch (error) {
        console.error('Error:', error);
        messageDiv.style.display = 'block';
        messageDiv.style.background = '#fee2e2';
        messageDiv.style.color = '#991b1b';
        messageDiv.textContent = 'An error occurred. Please try again.';
      } finally {
        // Re-enable button
        submitButton.disabled = false;
        submitButton.textContent = 'Send Reset Link';
      }
    });
